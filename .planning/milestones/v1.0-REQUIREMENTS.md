# Requirements Archive: v1.0 E-ink Color Rendering Fix

**Archived:** 2026-02-05
**Status:** SHIPPED

This is the archived requirements specification for v1.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

## v1 Requirements

### Distance Metric

- [x] **DIST-01**: HyAB distance metric includes chroma coupling penalty (`kchroma * |C_pixel - C_palette|`)
- [x] **DIST-02**: Palette precomputes chroma values (`sqrt(a^2 + b^2)`) for each actual OKLab entry at construction
- [x] **DIST-03**: Default kl=2.0, kc=1.0, kchroma=10.0 produces correct grey-to-achromatic mapping on BWRGBY
- [x] **DIST-04**: Chromatic-to-chromatic matching unaffected (orange maps to nearest chromatic, not forced to B/W)

### Auto-Detection

- [x] **AUTO-01**: Crate auto-detects chromatic palettes (any entry with chroma > threshold)
- [x] **AUTO-02**: Achromatic palettes default to Euclidean; chromatic palettes default to HyAB+chroma
- [x] **AUTO-03**: Auto-detection logic moved from `svg_to_png.rs` into eink-dither crate API

### Testing

- [x] **TEST-01**: Grey gradient (0-255) on BWRGBY palette produces only B/W indices
- [x] **TEST-02**: Pure chromatic colors (red, green, blue, yellow) match their palette entries exactly
- [x] **TEST-03**: Pastel/desaturated colors map to correct chromatic entries (not forced achromatic)
- [x] **TEST-04**: Edge cases tested: brown, skin tones, dark chromatic colors
- [x] **TEST-05**: Existing domain tests continue to pass

### Documentation

- [x] **DOCS-01**: Color science rationale documented for distance metric choice (HyAB + chroma coupling)
- [x] **DOCS-02**: Pipeline diagram in crate-level documentation showing color space at each stage
- [x] **DOCS-03**: Inline comments at every color space conversion explaining why that space is used

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| DIST-01 | Phase 1: Core Distance Metric Fix | Complete |
| DIST-02 | Phase 1: Core Distance Metric Fix | Complete |
| DIST-03 | Phase 1: Core Distance Metric Fix | Complete |
| DIST-04 | Phase 1: Core Distance Metric Fix | Complete |
| AUTO-01 | Phase 2: Auto-Detection and Edge Cases | Complete |
| AUTO-02 | Phase 2: Auto-Detection and Edge Cases | Complete |
| AUTO-03 | Phase 2: Auto-Detection and Edge Cases | Complete |
| TEST-01 | Phase 1: Core Distance Metric Fix | Complete |
| TEST-02 | Phase 1: Core Distance Metric Fix | Complete |
| TEST-03 | Phase 2: Auto-Detection and Edge Cases | Complete |
| TEST-04 | Phase 2: Auto-Detection and Edge Cases | Complete |
| TEST-05 | Phase 1: Core Distance Metric Fix | Complete |
| DOCS-01 | Phase 3: Color Science Documentation | Complete |
| DOCS-02 | Phase 3: Color Science Documentation | Complete |
| DOCS-03 | Phase 3: Color Science Documentation | Complete |

**Coverage:**
- v1 requirements: 15 total
- Shipped: 15
- Dropped: 0

---

## Milestone Summary

**Shipped:** 15 of 15 v1 requirements
**Adjusted:** DIST-03 kchroma value changed from 2.0 to 10.0 during Phase 1 (empirically determined)
**Dropped:** None

---
*Archived: 2026-02-05 as part of v1.0 milestone completion*
